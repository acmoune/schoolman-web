{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/data/apps/school-manager-client/pages/signIn.tsx\";\nvar __jsx = React.createElement;\nimport * as React from 'react';\nimport MainLayout from '../layouts/MainLayout';\nimport Container from '../components/Container';\nimport { Typography, Paper, TextField, Button } from '@material-ui/core';\nimport axios from 'axios';\nimport validator from 'validator';\nimport { apiBaseUrl, authCookieName } from '../app.config';\nimport { setCookie } from '../lib/cookie';\nimport Router from 'next/router';\nimport withApollo from '../lib/with-apollo';\nimport withAuth from '../lib/with-auth';\n\nfunction SignInPage(_ref) {\n  var backTo = _ref.backTo;\n\n  var _React$useState = React.useState(''),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      email = _React$useState2[0],\n      setEmail = _React$useState2[1];\n\n  var _React$useState3 = React.useState(''),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      password = _React$useState4[0],\n      setPassword = _React$useState4[1];\n\n  var _React$useState5 = React.useState({\n    emailErrors: [],\n    passwordErrors: []\n  }),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      inputErrors = _React$useState6[0],\n      setInputErrors = _React$useState6[1];\n\n  var _React$useState7 = React.useState([]),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      serverError = _React$useState8[0],\n      setServerError = _React$useState8[1];\n\n  var validateData = function validateData() {\n    var emailErrors = [];\n    var passwordErrors = [];\n    if (validator.isEmpty(email)) emailErrors.push('Your email is required');\n    if (!validator.isEmail(email)) emailErrors.push('Enter a valid email address');\n    if (validator.isEmpty(password)) passwordErrors.push('Your password is required');\n    var isValid = emailErrors.length == 0 && passwordErrors.length == 0;\n    var errors = {\n      emailErrors: emailErrors,\n      passwordErrors: passwordErrors\n    };\n    return {\n      isValid: isValid,\n      errors: errors\n    };\n  };\n\n  var submit = function submit(cb) {\n    var _validateData = validateData(),\n        isValid = _validateData.isValid,\n        errors = _validateData.errors;\n\n    setInputErrors(errors);\n\n    if (!isValid && errors) {\n      return cb('Please enter valid inputs', '');\n    }\n\n    return axios.post(\"\".concat(apiBaseUrl, \"/auth/authenticate\"), {\n      email: email,\n      password: password\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      return cb('', res.data.token);\n    })[\"catch\"](function (err) {\n      return cb(err.response.data.message, '');\n    });\n  };\n\n  return __jsx(MainLayout, {\n    title: \"Sign In\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51\n    },\n    __self: this\n  }, __jsx(Container, {\n    maxWidth: 400,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    style: {\n      marginTop: 50,\n      marginBottom: 20\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53\n    },\n    __self: this\n  }, __jsx(Typography, {\n    variant: \"h5\",\n    color: \"textSecondary\",\n    style: {\n      textAlign: 'center',\n      paddingBottom: 15\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54\n    },\n    __self: this\n  }, \"Sign In\"), __jsx(Paper, {\n    style: {\n      padding: 15\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56\n    },\n    __self: this\n  }, serverError.length > 0 && __jsx(\"div\", {\n    style: {\n      marginBottom: 15,\n      color: 'red'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57\n    },\n    __self: this\n  }, serverError.join(', ')), __jsx(TextField, {\n    id: \"email\",\n    name: \"email\",\n    label: \"Email\",\n    fullWidth: true,\n    value: email,\n    onChange: function onChange(e) {\n      return setEmail(e.target.value);\n    },\n    error: inputErrors.emailErrors.length > 0,\n    helperText: inputErrors.emailErrors.join(', '),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70\n    },\n    __self: this\n  }), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71\n    },\n    __self: this\n  }), __jsx(TextField, {\n    id: \"password\",\n    name: \"password\",\n    label: \"Password\",\n    type: \"password\",\n    fullWidth: true,\n    value: password,\n    onChange: function onChange(e) {\n      return setPassword(e.target.value);\n    },\n    error: inputErrors.passwordErrors.length > 0,\n    helperText: inputErrors.passwordErrors.join(', '),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }), __jsx(Button, {\n    color: \"secondary\",\n    size: \"large\",\n    fullWidth: true,\n    variant: \"contained\",\n    onClick: function onClick() {\n      return submit(function (errMessage, token) {\n        if (errMessage) return setServerError([errMessage]);\n        setCookie(authCookieName, token);\n        return Router.push(backTo || '/');\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, \"Sign In\"))), __jsx(\"div\", {\n    style: {\n      color: '#808080',\n      fontSize: '9pt',\n      padding: 10\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, \"Forgot your email or password ? Please contact Administration.\")));\n}\n\nSignInPage.getInitialProps = function (_ref2) {\n  var query = _ref2.query;\n  return {\n    backTo: query.backTo,\n    authRequired: false\n  };\n};\n\nexport default withApollo(withAuth(SignInPage));","map":{"version":3,"sources":["/data/apps/school-manager-client/pages/signIn.tsx"],"names":["React","MainLayout","Container","Typography","Paper","TextField","Button","axios","validator","apiBaseUrl","authCookieName","setCookie","Router","withApollo","withAuth","SignInPage","backTo","useState","email","setEmail","password","setPassword","emailErrors","passwordErrors","inputErrors","setInputErrors","serverError","setServerError","validateData","isEmpty","push","isEmail","isValid","length","errors","submit","cb","post","headers","then","res","data","token","err","response","message","marginTop","marginBottom","textAlign","paddingBottom","padding","color","join","e","target","value","errMessage","fontSize","getInitialProps","query","authRequired"],"mappings":";;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,SAASC,UAAT,EAAqBC,KAArB,EAA4BC,SAA5B,EAAuCC,MAAvC,QAAqD,mBAArD;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,WAAtB;AACA,SAASC,UAAT,EAAqBC,cAArB,QAA2C,eAA3C;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,UAAP,MAAuB,oBAAvB;AACA,OAAOC,QAAP,MAAqB,kBAArB;;AAIA,SAASC,UAAT,OAAoD;AAAA,MAA9BC,MAA8B,QAA9BA,MAA8B;;AAAA,wBACxBhB,KAAK,CAACiB,QAAN,CAAuB,EAAvB,CADwB;AAAA;AAAA,MAC3CC,KAD2C;AAAA,MACpCC,QADoC;;AAAA,yBAElBnB,KAAK,CAACiB,QAAN,CAAuB,EAAvB,CAFkB;AAAA;AAAA,MAE3CG,QAF2C;AAAA,MAEjCC,WAFiC;;AAAA,yBAGZrB,KAAK,CAACiB,QAAN,CAA4B;AAAEK,IAAAA,WAAW,EAAE,EAAf;AAAmBC,IAAAA,cAAc,EAAE;AAAnC,GAA5B,CAHY;AAAA;AAAA,MAG3CC,WAH2C;AAAA,MAG9BC,cAH8B;;AAAA,yBAIZzB,KAAK,CAACiB,QAAN,CAAyB,EAAzB,CAJY;AAAA;AAAA,MAI3CS,WAJ2C;AAAA,MAI9BC,cAJ8B;;AAMlD,MAAMC,YAAY,GAAG,SAAfA,YAAe,GAAiD;AACpE,QAAMN,WAAqB,GAAG,EAA9B;AACA,QAAMC,cAAwB,GAAG,EAAjC;AAEA,QAAIf,SAAS,CAACqB,OAAV,CAAkBX,KAAlB,CAAJ,EAA8BI,WAAW,CAACQ,IAAZ,CAAiB,wBAAjB;AAC9B,QAAI,CAACtB,SAAS,CAACuB,OAAV,CAAkBb,KAAlB,CAAL,EAA+BI,WAAW,CAACQ,IAAZ,CAAiB,6BAAjB;AAE/B,QAAItB,SAAS,CAACqB,OAAV,CAAkBT,QAAlB,CAAJ,EAAiCG,cAAc,CAACO,IAAf,CAAoB,2BAApB;AAEjC,QAAME,OAAO,GAAGV,WAAW,CAACW,MAAZ,IAAsB,CAAtB,IAA2BV,cAAc,CAACU,MAAf,IAAyB,CAApE;AACA,QAAMC,MAAM,GAAG;AAAEZ,MAAAA,WAAW,EAAXA,WAAF;AAAeC,MAAAA,cAAc,EAAdA;AAAf,KAAf;AACA,WAAQ;AAAES,MAAAA,OAAO,EAAPA,OAAF;AAAWE,MAAAA,MAAM,EAANA;AAAX,KAAR;AACD,GAZD;;AAcA,MAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,EAAD,EAAoD;AAAA,wBACrCR,YAAY,EADyB;AAAA,QACzDI,OADyD,iBACzDA,OADyD;AAAA,QAChDE,MADgD,iBAChDA,MADgD;;AAEjET,IAAAA,cAAc,CAACS,MAAD,CAAd;;AAEA,QAAI,CAACF,OAAD,IAAYE,MAAhB,EAAwB;AACtB,aAAOE,EAAE,CAAC,2BAAD,EAA8B,EAA9B,CAAT;AACD;;AAED,WAAO7B,KAAK,CAAC8B,IAAN,WAAc5B,UAAd,yBAA8C;AAAES,MAAAA,KAAK,EAALA,KAAF;AAASE,MAAAA,QAAQ,EAARA;AAAT,KAA9C,EAAmE;AACxEkB,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB;AAD+D,KAAnE,EAGJC,IAHI,CAGC,UAAAC,GAAG;AAAA,aAAIJ,EAAE,CAAC,EAAD,EAAKI,GAAG,CAACC,IAAJ,CAASC,KAAd,CAAN;AAAA,KAHJ,WAIE,UAAAC,GAAG;AAAA,aAAIP,EAAE,CAACO,GAAG,CAACC,QAAJ,CAAaH,IAAb,CAAkBI,OAAnB,EAA4B,EAA5B,CAAN;AAAA,KAJL,CAAP;AAKD,GAbD;;AAeA,SACE,MAAC,UAAD;AAAY,IAAA,KAAK,EAAC,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,SAAD;AAAW,IAAA,QAAQ,EAAE,GAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,KAAK,EAAE;AAAEC,MAAAA,SAAS,EAAE,EAAb;AAAiBC,MAAAA,YAAY,EAAE;AAA/B,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,UAAD;AAAY,IAAA,OAAO,EAAC,IAApB;AAAyB,IAAA,KAAK,EAAC,eAA/B;AAA+C,IAAA,KAAK,EAAE;AAAEC,MAAAA,SAAS,EAAE,QAAb;AAAuBC,MAAAA,aAAa,EAAE;AAAtC,KAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,EAGE,MAAC,KAAD;AAAO,IAAA,KAAK,EAAE;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGxB,WAAW,CAACO,MAAZ,GAAqB,CAArB,IAA0B;AAAK,IAAA,KAAK,EAAE;AAAEc,MAAAA,YAAY,EAAE,EAAhB;AAAoBI,MAAAA,KAAK,EAAE;AAA3B,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAiDzB,WAAW,CAAC0B,IAAZ,CAAiB,IAAjB,CAAjD,CAD7B,EAGE,MAAC,SAAD;AACE,IAAA,EAAE,EAAC,OADL;AAEE,IAAA,IAAI,EAAC,OAFP;AAGE,IAAA,KAAK,EAAC,OAHR;AAIE,IAAA,SAAS,MAJX;AAKE,IAAA,KAAK,EAAElC,KALT;AAME,IAAA,QAAQ,EAAE,kBAACmC,CAAD;AAAA,aAA4ClC,QAAQ,CAACkC,CAAC,CAACC,MAAF,CAASC,KAAV,CAApD;AAAA,KANZ;AAOE,IAAA,KAAK,EAAE/B,WAAW,CAACF,WAAZ,CAAwBW,MAAxB,GAAiC,CAP1C;AAQE,IAAA,UAAU,EAAET,WAAW,CAACF,WAAZ,CAAwB8B,IAAxB,CAA6B,IAA7B,CARd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,EAcE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAdF,EAeE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAfF,EAiBE,MAAC,SAAD;AACE,IAAA,EAAE,EAAC,UADL;AAEE,IAAA,IAAI,EAAC,UAFP;AAGE,IAAA,KAAK,EAAC,UAHR;AAIE,IAAA,IAAI,EAAC,UAJP;AAKE,IAAA,SAAS,MALX;AAME,IAAA,KAAK,EAAEhC,QANT;AAOE,IAAA,QAAQ,EAAE,kBAACiC,CAAD;AAAA,aAA4ChC,WAAW,CAACgC,CAAC,CAACC,MAAF,CAASC,KAAV,CAAvD;AAAA,KAPZ;AAQE,IAAA,KAAK,EAAE/B,WAAW,CAACD,cAAZ,CAA2BU,MAA3B,GAAoC,CAR7C;AASE,IAAA,UAAU,EAAET,WAAW,CAACD,cAAZ,CAA2B6B,IAA3B,CAAgC,IAAhC,CATd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAjBF,EA6BE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA7BF,EA8BE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA9BF,EA+BE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA/BF,EAiCE,MAAC,MAAD;AACE,IAAA,KAAK,EAAC,WADR;AAEE,IAAA,IAAI,EAAC,OAFP;AAGE,IAAA,SAAS,MAHX;AAIE,IAAA,OAAO,EAAC,WAJV;AAKE,IAAA,OAAO,EAAE;AAAA,aAAMjB,MAAM,CAAC,UAACqB,UAAD,EAAad,KAAb,EAAuB;AAC3C,YAAIc,UAAJ,EAAgB,OAAO7B,cAAc,CAAC,CAAC6B,UAAD,CAAD,CAArB;AAChB7C,QAAAA,SAAS,CAACD,cAAD,EAAiBgC,KAAjB,CAAT;AACA,eAAO9B,MAAM,CAACkB,IAAP,CAAYd,MAAM,IAAI,GAAtB,CAAP;AACD,OAJoB,CAAZ;AAAA,KALX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAjCF,CAHF,CADF,EAqDE;AAAK,IAAA,KAAK,EAAE;AAAEmC,MAAAA,KAAK,EAAE,SAAT;AAAoBM,MAAAA,QAAQ,EAAE,KAA9B;AAAqCP,MAAAA,OAAO,EAAE;AAA9C,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sEArDF,CADF,CADF;AA6DD;;AAEDnC,UAAU,CAAC2C,eAAX,GAA6B;AAAA,MAAGC,KAAH,SAAGA,KAAH;AAAA,SAAqB;AAAE3C,IAAAA,MAAM,EAAE2C,KAAK,CAAC3C,MAAhB;AAAwB4C,IAAAA,YAAY,EAAE;AAAtC,GAArB;AAAA,CAA7B;;AAEA,eAAe/C,UAAU,CAACC,QAAQ,CAACC,UAAD,CAAT,CAAzB","sourcesContent":["import * as React from 'react'\nimport MainLayout from '../layouts/MainLayout'\nimport Container from '../components/Container'\nimport { Typography, Paper, TextField, Button } from '@material-ui/core'\nimport axios from 'axios'\nimport validator from 'validator'\nimport { apiBaseUrl, authCookieName } from '../app.config'\nimport { setCookie } from '../lib/cookie'\nimport Router from 'next/router'\nimport withApollo from '../lib/with-apollo'\nimport withAuth from '../lib/with-auth'\n\ntype InputErrors = { emailErrors: string[], passwordErrors: string[] }\n\nfunction SignInPage({ backTo }: { backTo: string }) {\n  const [email, setEmail] = React.useState<string>('')\n  const [password, setPassword] = React.useState<string>('')\n  const [inputErrors, setInputErrors] = React.useState<InputErrors>({ emailErrors: [], passwordErrors: []})\n  const [serverError, setServerError] = React.useState<string[]>([])\n\n  const validateData = (): { isValid: boolean, errors: InputErrors } => {\n    const emailErrors: string[] = []\n    const passwordErrors: string[] = []\n\n    if (validator.isEmpty(email)) emailErrors.push('Your email is required')\n    if (!validator.isEmail(email)) emailErrors.push('Enter a valid email address')\n\n    if (validator.isEmpty(password)) passwordErrors.push('Your password is required')\n\n    const isValid = emailErrors.length == 0 && passwordErrors.length == 0\n    const errors = { emailErrors, passwordErrors }\n    return ({ isValid, errors })\n  }\n\n  const submit = (cb: (errMessage: string, token: string) => any) => {\n    const { isValid, errors } = validateData()\n    setInputErrors(errors)\n\n    if (!isValid && errors) {\n      return cb('Please enter valid inputs', '')\n    }\n\n    return axios.post(`${apiBaseUrl}/auth/authenticate`, { email, password }, {\n      headers: { 'Content-Type': 'application/json' }\n    })\n      .then(res => cb('', res.data.token))\n      .catch(err => cb(err.response.data.message, ''))\n  }\n\n  return (\n    <MainLayout title=\"Sign In\">\n      <Container maxWidth={400}>\n        <div style={{ marginTop: 50, marginBottom: 20 }}>\n          <Typography variant=\"h5\" color=\"textSecondary\" style={{ textAlign: 'center', paddingBottom: 15 }}>Sign In</Typography>\n\n          <Paper style={{ padding: 15 }}>\n            {serverError.length > 0 && <div style={{ marginBottom: 15, color: 'red' }}>{serverError.join(', ')}</div>}\n\n            <TextField\n              id=\"email\"\n              name=\"email\"\n              label=\"Email\"\n              fullWidth\n              value={email}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setEmail(e.target.value)}\n              error={inputErrors.emailErrors.length > 0}\n              helperText={inputErrors.emailErrors.join(', ')}\n            />\n\n            <br />\n            <br />\n\n            <TextField\n              id=\"password\"\n              name=\"password\"\n              label=\"Password\"\n              type=\"password\"\n              fullWidth\n              value={password}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setPassword(e.target.value)}\n              error={inputErrors.passwordErrors.length > 0}\n              helperText={inputErrors.passwordErrors.join(', ')}\n            />\n\n            <br />\n            <br />\n            <br />\n\n            <Button\n              color=\"secondary\"\n              size=\"large\"\n              fullWidth\n              variant=\"contained\"\n              onClick={() => submit((errMessage, token) => {\n                if (errMessage) return setServerError([errMessage])\n                setCookie(authCookieName, token)\n                return Router.push(backTo || '/')\n              })}\n            >\n              Sign In\n            </Button>\n          </Paper>\n        </div>\n\n        <div style={{ color: '#808080', fontSize: '9pt', padding: 10 }}>\n          Forgot your email or password ? Please contact Administration.\n        </div>\n      </Container>\n    </MainLayout>\n  )\n}\n\nSignInPage.getInitialProps = ({ query }: any) => ({ backTo: query.backTo, authRequired: false })\n\nexport default withApollo(withAuth(SignInPage))\n"]},"metadata":{},"sourceType":"module"}