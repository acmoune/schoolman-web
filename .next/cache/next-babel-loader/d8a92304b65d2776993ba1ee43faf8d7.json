{"ast":null,"code":"var _jsxFileName = \"/data/apps/opensource/SchoolMan/web-client/pages/application.tsx\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Container from '../components/Container';\nimport MainLayout from '../layouts/MainLayout';\nimport Router from 'next/router';\nimport ApplicationStepper from '../components/ApplicationStepper';\nimport { gql } from 'apollo-boost';\nimport withApollo from '../lib/with-apollo';\nimport withAuth from '../lib/with-auth';\nconst GET_SESSION_QUERY = gql`\n  query getTrainingSession($trainingSessionId: ID!) {\n    trainingSession(trainingSessionId: $trainingSessionId) {\n      id\n      title\n      startDate\n      status\n      fees {id description amount feeType optional}\n      plan {\n        id\n        title\n        duration\n        training {\n          id\n          title\n          program {\n            id\n            title\n            department { id title }\n          }\n        }\n      }\n    }\n  }\n`;\n\nfunction ApplicationPage({\n  profile,\n  tSession\n}) {\n  const handleCancel = () => Router.push({\n    pathname: '/training',\n    query: {\n      trainingId: tSession.plan.training.id\n    }\n  });\n\n  return __jsx(MainLayout, {\n    title: `Applying for ${tSession.plan.training.title} (${tSession.plan.title}) - IMIT`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42\n    },\n    __self: this\n  }, __jsx(Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43\n    },\n    __self: this\n  }, __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44\n    },\n    __self: this\n  }), __jsx(ApplicationStepper, {\n    handleCancel: handleCancel,\n    trainingTitle: tSession.plan.training.title,\n    programTitle: tSession.plan.training.program.title,\n    departmentTitle: tSession.plan.training.program.department.title,\n    planTitle: tSession.plan.title,\n    planDuration: tSession.plan.duration,\n    session: tSession,\n    profile: profile,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  })));\n}\n\nconst GET_PROFILE_QUERY = gql`\n  query getProfile($email: String!) {\n    account(email: $email) {\n      id\n      email\n      fullName\n      profile {\n        id birthDate birthPlace residence phoneNumber nationality\n        nicNumber nicDateOfIssue nicPlaceOfIssue\n        highestAcademicQualification yearOfIssue englishGradeInGCEOL mathematicsGradeInGCEOL\n        professionalQualification employmentStatus jobTitle yearsOfExperience employerName employerAddress\n        otherDetails\n      }\n    }\n  }\n`;\n\nApplicationPage.getInitialProps = async ({\n  query,\n  apolloClient,\n  token,\n  currentUser\n}) => {\n  var profile = null;\n\n  if (currentUser) {\n    const {\n      data: {\n        account\n      }\n    } = await apolloClient.query({\n      query: GET_PROFILE_QUERY,\n      variables: {\n        email: currentUser.email\n      },\n      context: {\n        headers: {\n          'schoolman_token': token\n        }\n      }\n    });\n    profile = account.profile;\n  }\n\n  const {\n    data: {\n      trainingSession\n    }\n  } = await apolloClient.query({\n    query: GET_SESSION_QUERY,\n    variables: {\n      trainingSessionId: query.tsId\n    },\n    context: {\n      headers: {\n        'schoolman_token': token\n      }\n    }\n  });\n  return {\n    profile,\n    tSession: trainingSession,\n    authReuired: true\n  };\n};\n\nexport default withApollo(withAuth(ApplicationPage));","map":{"version":3,"sources":["/data/apps/opensource/SchoolMan/web-client/pages/application.tsx"],"names":["React","Container","MainLayout","Router","ApplicationStepper","gql","withApollo","withAuth","GET_SESSION_QUERY","ApplicationPage","profile","tSession","handleCancel","push","pathname","query","trainingId","plan","training","id","title","program","department","duration","GET_PROFILE_QUERY","getInitialProps","apolloClient","token","currentUser","data","account","variables","email","context","headers","trainingSession","trainingSessionId","tsId","authReuired"],"mappings":"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","sourcesContent":["import React from 'react'\nimport Container from '../components/Container'\nimport MainLayout from '../layouts/MainLayout'\nimport Router from 'next/router'\nimport ApplicationStepper from '../components/ApplicationStepper'\nimport { gql } from 'apollo-boost'\nimport ITrainingSession from '../server/src/models/catalog/TrainingSession'\nimport IAccountProfileFields from '../server/src/models/accounts/AccountProfile'\nimport withApollo from '../lib/with-apollo'\nimport withAuth from '../lib/with-auth'\n\nconst GET_SESSION_QUERY = gql`\n  query getTrainingSession($trainingSessionId: ID!) {\n    trainingSession(trainingSessionId: $trainingSessionId) {\n      id\n      title\n      startDate\n      status\n      fees {id description amount feeType optional}\n      plan {\n        id\n        title\n        duration\n        training {\n          id\n          title\n          program {\n            id\n            title\n            department { id title }\n          }\n        }\n      }\n    }\n  }\n`\n\nfunction ApplicationPage({ profile, tSession }: { profile: IAccountProfileFields, tSession: ITrainingSession }) {\n  const handleCancel = () => Router.push({ pathname: '/training', query: { trainingId: tSession.plan.training.id }})\n  \n  return (\n    <MainLayout title={`Applying for ${tSession.plan.training.title} (${tSession.plan.title}) - IMIT`}>\n      <Container>\n        <br />\n        <ApplicationStepper \n          handleCancel={handleCancel}\n          trainingTitle={tSession.plan.training.title}\n          programTitle={tSession.plan.training.program.title}\n          departmentTitle={tSession.plan.training.program.department.title}\n          planTitle={tSession.plan.title}\n          planDuration={tSession.plan.duration}\n          session={tSession}\n          profile={profile}\n        />\n      </Container>\n    </MainLayout>\n  )\n}\n\nconst GET_PROFILE_QUERY = gql`\n  query getProfile($email: String!) {\n    account(email: $email) {\n      id\n      email\n      fullName\n      profile {\n        id birthDate birthPlace residence phoneNumber nationality\n        nicNumber nicDateOfIssue nicPlaceOfIssue\n        highestAcademicQualification yearOfIssue englishGradeInGCEOL mathematicsGradeInGCEOL\n        professionalQualification employmentStatus jobTitle yearsOfExperience employerName employerAddress\n        otherDetails\n      }\n    }\n  }\n`\n\nApplicationPage.getInitialProps = async ({ query, apolloClient, token, currentUser }: any) => {\n  var profile = null\n  \n  if (currentUser) {\n    const { data: { account }} = await apolloClient.query({\n      query: GET_PROFILE_QUERY,\n      variables: { email: currentUser.email },\n      context: { headers: { 'schoolman_token': token } }\n    })\n\n    profile = account.profile\n  }\n\n  const { data: { trainingSession }} = await apolloClient.query({\n    query: GET_SESSION_QUERY,\n    variables: { trainingSessionId: query.tsId },\n    context: { headers: { 'schoolman_token': token } }\n  })\n\n  return ({ profile, tSession: trainingSession, authReuired: true })\n}\n\nexport default withApollo(withAuth(ApplicationPage))\n"]},"metadata":{},"sourceType":"module"}